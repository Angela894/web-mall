<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/reset1.css">
    <link rel="stylesheet" href="../css/panier.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/sidebar.css">
</head>
<body>
<!--左边框-->
<div class="sidebar">
    <div class="border">
        <li class="member">
            <i></i>
            <a href="javascript:">国美会员</a>
        </li>
    </div>
    <div class="cart">
        <li class="vehicle">
            <i></i>
            <a href="../html/cart.html">购物车</a>
        </li>
        <div class="cart-tip">
            <a href="../html/cart.html">购物车</a>
            中还没有商品，赶快选购吧！
        </div>
    </div>
    <div class="collect">
        <div class="collect-box">
            <i></i>
            <a href="javascript:">我的收藏</a>
        </div>
    </div>
    <div class="scan">
        <li>
            <i></i>
            <img src="../img/T1LJVvB7KT1RCvBVdK.jpg" alt="">
            <a href="javascript:"></a>
        </li>
        <div class="scan-top">
            <i></i>
            <a href="javascript:">首页反馈</a>
        </div>
        <div class="scan-bot">
            <i></i>
            <a href="javascript:">在线客服</a>
        </div>

    </div>
</div>
<!--导航栏-->
<div class="nav">
    <div class="nav-nav">
        <div class="nav-left">
            <ul>
                <li class="tiger">
                    <a href="javascript:">
                        <p></p>
                        国美
                    </a>
                </li>
                <li class="xian"></li>
                <li class="guomei"> <a href="../html/login.html">国美会员
                    <div class="guomei-membre">
                        <div id="guomei-membre-top">
                            <div></div>
                            <p>
                                欢迎来到国美
                                <a class="zi" href="../#">请登录！</a>
                            </p>
                        </div>
                        <div id="guomei-membre-bottom">
                            <img src="../img/GM.png" alt="">
                        </div>
                    </div>
                </a>
                </li>
                <li> <a href="../html/login.html">登录  </a></li>
                <li> <a href="../html/register.html">注册 </a></li>
                <li><a href="#" name="username" class="username">asdfghjkl1</a></li>
                <!-- 可以在a链接里面写javascript代码，在href属性中以javascript:开头，后面写js代码 -->
                <li> <a href="javascript:localStorage.clear(); location.reload();" class="logout">退出</a></li>
            </ul>

        </div>
        <div class="nav-right">
            <ul>
                <li> <a href="javascript:">我的订单  </a></li>
                <li class="my"> <a href="javascript:">我的国美
                    <div class="my-mei">
                        <div class="my-mei-top">
                            <p>我的国美，<i >请登录!</i></p>
                            <div>待处理订单<span> 我的收藏</span></div>
                            <div>我的金融<span> 个人资料</span></div>
                        </div>
                        <div class="my-mei-bottom">
                            <ul>
                                <li href="javascript:">红卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">蓝卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">店铺卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">购物卷</li>
                            </ul>
                        </div>
                    </div>
                </a></li>
                <li> <a href="javascript:">企业采购  </a></li>
                <li class="servir-servir"> <a href="javascript:">服务中心
                    <div class="servir">
                        <h3>售后服务</h3>
                        <div>物流与配送 <span>上门安装</span> <span>退换货服务</span></div>
                        <div>手机维修 &nbsp;&nbsp;&nbsp;<span>延保服务</span> <span>家电回收</span></div>
                        <h3>帮助问题</h3>
                        <div>焦点问题 <span>账户安全</span> <span>签收与验货</span></div>
                        <div>分期付款 <span>退款说明</span> <span>优惠券说明</span></div>
                        <p>在线客服</p>
                    </div>
                </a></li>
                <li class="qiye"> <a href="javascript:">企业导航
                    <div class="entreprise">
                        <dl>
                            <dt>主题促销</dt>
                            <dd>真划算 <span>家电城</span> <span>智能家居</span></dd>
                            <dd>抢购 <span>家装馆</span> <span>国美超市</span></dd>
                            <dd>海外购 <span>服饰城</span> <span>新品抢先</span></dd>
                            <dd>品牌街 <span>今日特卖</span></dd>
                            <dd></dd>
                        </dl>

                        <dl>
                            <dt> 特色分类</dt>
                            <dd>电视影音 <span>手机</span> <span>住宅家具</span> <span>服饰鞋帽</span> <span>食品酒水</span></dd>
                            <dd>冰洗 <span>数码</span> <span>家装建材</span> <span>运动户外</span> <span>医疗保健</span></dd>
                            <dd>洗衣机 <span>电脑办公</span> <span>家居日用</span> <span>箱包奢品</span> <span>母婴玩具</span></dd>
                            <dd>空调 <span>精品配件</span> <span>床品家纺</span> <span>表首饰</span> <span>美妆个护</span></dd>
                            <dd>厨卫生活 <span>汽车</span> <span>黄金收藏</span> <span>文化艺术</span> <span>家装频道</span></dd>
                        </dl>
                        <dl class="char">
                            <dt>便捷服务</dt>
                            <dd>话费充值 <span>流量充值</span></dd>
                            <dd>游戏点卡 <span>酒店</span></dd>
                            <dd>机票 <span>火车票</span></dd>
                            <dd>电影票 <span>演出票</span></dd>
                            <dd>美盈宝 <span>投金宝</span></dd>
                            <dd>定期理财 <span>票据理财</span></dd>
                            <dd>转让理财 <span> 转让理财</span></dd>
                        </dl>
                        <dl>
                            <dt>更多热点</dt>
                            <dd>商家入驻</dd>
                            <dd>企业采购</dd>
                        </dl>
                        <dl>
                            <dt>国美旗下</dt>
                            <dd>多边金都</dd>
                            <dd>国美家装</dd>
                            <dd>国美管家</dd>
                        </dl>
                    </div>
                </a></li>
                <li class="code"> <a href="javascript:">手机国美
                    <div class="portable-code">
                        <i></i>
                    </div>
                </a></li>
            </ul>
        </div>
    </div>
</div>
<!--搜索-->
<div class="helloworld">
    <div class="logo">
        <a href="../index.html"></a>
    </div>
    <div class="helloworld-left">
       <h1><a href="../html/pose.html">购物车</a></h1>
    </div>
</div>
<ul id="cat" class="cat"></ul>
<main>
    <table>
        <tr>
            <td>商品ID</td>
            <td>图片</td>
            <td>名称</td>
            <td>数量</td>
            <td>单价</td>
            <td>总价</td>
            <td>操作</td>
        </tr>
    </table>
    <div class="pourpre">小计：<span id="sum">0</span> <input type="button" id="clear-cart" value="清空购物车">
        <button><a href="address.html">结算</a></button>
    </div>
</main>
<div class="footer">
    <div class="footer-top">
        <li><a href="" class="outer">
            <p>品质</p></a>
            <span></span>
            <a href="" class="inside">正品行货 购物无忧</a></li>
        <li><a href="" class="outer outer2">
            <p>低价</p></a>
            <span></span>
            <a href="" class="inside">普惠实价 帮你省钱</a></li>
        <li><a href="" class="outer outer3">
            <p>速达</p></a>
            <span></span>
            <a href="" class="inside">专业配送 按时按需</a></li>
    </div>
    <!--服务列表-->
    <div class="footer-centre">
        <li class="footer-centre0">
            <p class="footer-centre1">物流配送</p>
            <p><a href="javascript:">配送查询</a></p>
            <p><a href="javascript:">配送服务</a></p>
            <p><a href="javascript:">配送费用</a></p>
            <p><a href="javascript:">配送时效</a></p>
            <p><a href="javascript:">签收与验货</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">支付与账户</p>
            <p><a href="javascript:">货到付款</a></p>
            <p><a href="javascript:">在线支付</a></p>
            <p><a href="javascript:">分期付款</a></p>
            <p><a href="javascript:">门店支付</a></p>
            <p><a href="javascript:">账户安全</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">售后服务</p>
            <p><a href="javascript:">退换货服务</a></p>
            <p><a href="javascript:">退款说明</a></p>
            <p><a href="javascript:">专业维修</a></p>
            <p><a href="javascript:">延保服务</a></p>
            <p><a href="javascript:">家电回收</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">会员专区</p>
            <p><a href="javascript:">会员介绍</a></p>
            <p><a href="javascript:">优惠券说明</a></p>
            <p><a href="javascript:">美豆说明</a></p>
            <p><a href="javascript:">商品评价</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">购物帮助</p>
            <p><a href="javascript:">购物保障</a></p>
            <p><a href="javascript:">购物流程</a></p>
            <p><a href="javascript:">促销优惠</a></p>
            <p><a href="javascript:">焦点问题</a></p>
            <p><a href="javascript:">联系我们</a></p>
        </li>
    </div>
    <!--商城介绍-->
    <div class="footer-bottom">
        <div class="footer-bottom0">
            <div class="box">
                <span>
                    <i></i>
                    <p>
                        <strong>门店服务</strong>
                        <a href="javascript:">国美门店全国共2000余家</a>
                    </p>
                </span>
                <span>
                    <i class="box-fix"></i>
                    <p>
                        <strong>用户体验</strong>
                        <a href="javascript:">参与用户体验改进计划 用户反馈</a>
                    </p>
                </span>
                <div class="code">
                    <i></i>
                    <p>公众号</p>
                    <div class="code-img">
                        <img src="../img/T1GObvBQZs1RCvBVdK.jpg">
                    </div>
                </div>
                <div class="code code-wap">
                    <i class="code-wap1"></i>
                    <p>手机站点</p>
                    <div class="code-img">
                        <img src="../img/T1m2YvBTDj1RCvBVdK.jpg">
                    </div>
                </div>
                <div class="code-app">
                    <i><img src="../img/T1g2LvBbdj1RCvBVdK.png" alt=""></i>
                    <p>扫描下载客户端</p>

                </div>
                <ul class="headline">
                    <a href="javascript:"><li>国美集团</li></a>
                    <a href="javascript:"><li>国美管家</li></a>
                    <a href="javascript:"><li>关于国美</li></a>
                    <a href="javascript:"><li>加入我们 &nbsp;&nbsp;|</li></a>
                    <a href="javascript:"> <li>品牌大全</li></a>
                    <a href="javascript:"> <li>商品专题</li></a>
                    <a href="javascript:"><li>批发大全</li></a>
                    <a href="javascript:"><li>热词搜索</li></a>
                    <a href="javascript:"><li>友情链接</li></a>
                    <a href="javascript:"><li>风险监测 &nbsp;&nbsp;|</li></a>
                    <a href="javascript:"><li>销售联盟</li></a>
                    <a href="javascript:"> <li>商家入驻</li></a>
                </ul>
                <p class="version">国美在线电子商务有限公司  办公地址:上海市嘉定区沪宜公路3163-3199号一楼A区  客服电话:4008708708  |  本公司游戏产品适合18岁以上成年人使用</p>
                <p class="version">2000-2017  国美在线电子商务有限公司版权所有  京公安网备11010502027062  沪ICP备11009419号  沪B2-20120004号</p>
                <div class="credit">
                    <ul class="credits">
                        <li><div class="img xinxi"></div><p>经营性网站备案信息</p></li>
                        <li><div class="img pinjia"></div><p>可信网站信用评价</p></li>
                        <li><div class="img wangzhan"></div><p>诚信网站</p></li>
                        <li><div class="img jingcha"></div><p>朝阳网络警察</p></li>
                        <li><div class="img dajiaping"></div><p>网购大家评</p></li>
                        <li class="change"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../js/myajax.js"></script>
<script>
    //判断用户名如果存在, 则显示用户名并显示退出按钮, 否则显示注册和登录
    if(localStorage.username){
        var oUsername=document.querySelector("a[name=username]");
        var oLogout=document.querySelector(".logout");
        oUsername.innerText=localStorage.username;
        oUsername.style.display="inline";
        oLogout.style.display="inline";
    }else {
        var oRegister = document.querySelector('.register');
        var oLogin = document.querySelector('.login');
        oRegister.style.display = 'inline';
        oLogin.style.display = 'inline';
    }
</script>
<script>
    var oCat = document.querySelector('#cat');
    myajax.get('http://h6.duchengjiu.top/shop/api_cat.php', {}, function(error, responseText){
        var json = JSON.parse(responseText);//返回的整个json对象
        var data = json.data;//json对象当中的data是一个数组
        for (var i = 0; i < data.length; i++) {
            var obj = data[i];//数组里面的每一项是一个商品分类的对象
            oCat.innerHTML += `<li><a href="../index.html?cat_id=${obj.cat_id}">${obj.cat_name}</a></li>`;
        }
    });
</script>
<script>
    var oTable=document.querySelector("table");
    var oSum=document.querySelector("#sum");
    myajax.get("http://h6.duchengjiu.top/shop/api_cart.php",{
        token:localStorage.token
    },function(error,responseText){
        var json=JSON.parse(responseText);
        console.log(json);
        var data=json.data;

        for(var i=0;i<data.length;i++){
            var obj=data[i];
            obj.goods_sum=obj.goods_price*obj.goods_number;

            console.log(obj.goods_sum)
            oTable.innerHTML +=`<tr>
                    <td name="goods_id">${obj.goods_id}</td>
                    <td><img src="${obj.goods_thumb}" alt=""></td>
                    <td>${obj.goods_name}</td>
                    <td><input data-id="${obj.goods_id}" type="number" value="1" min="0" name="number" value="${obj.goods_name}"></td>
                    <td>${obj.goods_price}</td>
                    <td name="sum">${obj.goods_sum}</td>
                     <td><input data-id="${obj.goods_id}" type="button" name="delete" value="删除"></td>
                </tr>`;
        }
        getSum()
    });
    oTable.onchange=function(event){
        event=event||window.event;
        var target=event.target||event.srcElement;
        if(target.name==='number'){
//            if(isNaN(parseInt(target.value))){
//
//            }
            console.log(target.value,target.dataset.id);
            var goods_id=target.dataset.id;
            var number=target.value;
            myajax.post('http://h6.duchengjiu.top/shop/api_cart.php?token='+localStorage.token,{
                goods_id,number
            },function(error,responseText){
                var json=JSON.parse(responseText);
                console.log(json);
                if(json.code===0){
                    // alert('更新购物车成功');
                    //修改总价和小计
                    var goods_price=parseInt(target.parentNode.nextElementSibling.innerText);
                    target.parentNode.nextElementSibling.nextElementSibling.innerText=parseInt(target.value)*goods_price;
                    getSum()
                }
            })
        }
    }
    oTable.addEventListener('click', function(event){
        event = event || window.event;
        var target = event.target || event.srcElement;
        if (target.name === 'delete') {
            if (!confirm('确认要删除吗')) { //当你选择的是取消则不执行任何事情
                return;
            }
            //得到商品ID
            var goods_id = target.dataset.id;
            var number = 0;
            myajax.post('http://h6.duchengjiu.top/shop/api_cart.php?token='+localStorage.token,
                    {goods_id, number},
                    (err, responseText) => {
                var json = JSON.parse(responseText);
            console.log(json);
            if (json.code === 0) {
                // alert('更新购物车成功');
                //删除整个TR
                var tr = target.parentNode.parentNode;
                tr.parentNode.removeChild(tr);
                //显示总价
                getSum();
            }
        })
        }
    });


    var oClearCart = document.querySelector('#clear-cart');
    oClearCart.onclick = () => {
        if (!confirm('确认要清空整个购物车吗？')) {
            return;
        }
        //得到所有的商品ID
        var oGoodsIds = document.querySelectorAll('td[name=goods_id]');
        for (var i = 0; i < oGoodsIds.length; i++) {
            var td = oGoodsIds[i];
            var goods_id = parseInt(td.innerText);
            var number = 0;
            (function(td){
                myajax.post('http://h6.duchengjiu.top/shop/api_cart.php?token='+localStorage.token,
                        {goods_id,number},
                        (error,responseText) => {
                    var json = JSON.parse(responseText);
                console.log(json);
                if (json.code === 0) {
                    alert('更新购物车成功');
                    //删除整个TR
                    var tr = td.parentNode;
                    tr.parentNode.removeChild(tr);
                    //显示总价
                    getSum();
                }
            });
            })(td);
        }
    }

    function getSum(){
        var oSums = document.querySelectorAll('td[name=sum]');
        var sum=0;
        for(var i=0;i<oSums.length;i++){
            sum+=parseInt(oSums[i].innerText)
        }
        localStorage.sum = sum;
        oSum.innerText = "￥" + sum;
    }
</script>
</html>