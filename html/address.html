<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>收货地址</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/reset1.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/arreter.css">
</head>
<body>
<div class="sidebar">
    <div class="border">
        <li class="member">
            <i></i>
            <a href="javascript:">国美会员</a>
        </li>
    </div>
    <div class="cart">
        <li class="vehicle">
            <i></i>
            <a href="javascript:">购物车</a>
        </li>
        <div class="cart-tip">
            <a href="javascript:">购物车</a>
            中还没有商品，赶快选购吧！
        </div>
    </div>
    <div class="collect">
        <div class="collect-box">
            <i></i>
            <a href="javascript:">我的收藏</a>
        </div>
    </div>
    <div class="scan">
        <li>
            <i></i>
            <img src="../img/T1LJVvB7KT1RCvBVdK.jpg" alt="">
            <a href="javascript:"></a>
        </li>
        <div class="scan-top">
            <i></i>
            <a href="javascript:">首页反馈</a>
        </div>
        <div class="scan-bot">
            <i></i>
            <a href="javascript:">在线客服</a>
        </div>

    </div>
</div>
<!--导航栏-->
<div class="nav">
    <div class="nav-nav">
        <div class="nav-left">
            <ul>
                <li class="tiger">
                    <a href="javascript:">
                        <p></p>
                        国美
                    </a>
                </li>
                <li class="xian"></li>
                <li class="guomei"> <a href="../html/login.html">国美会员
                    <div class="guomei-membre">
                        <div id="guomei-membre-top">
                            <div></div>
                            <p>
                                欢迎来到国美
                                <a class="zi" href="#">请登录！</a>
                            </p>
                        </div>
                        <div id="guomei-membre-bottom">
                            <img src="../img/GM.png" alt="">
                        </div>
                    </div>
                </a></li>
                <li> <a href="../html/login.html">登录  </a></li>
                <li> <a href="../html/register.html">注册  </a></li>
                <li><a href="#" name="username" class="username">asdfghjkl1</a></li>
                <!-- 可以在a链接里面写javascript代码，在href属性中以javascript:开头，后面写js代码 -->
                <li> <a href="javascript:localStorage.clear(); location.reload();" class="logout">退出</a></li>
            </ul>
        </div>
        <div class="nav-right">
            <ul>
                <li> <a href="javascript:">我的订单  </a></li>
                <li class="my"> <a href="javascript:">我的国美
                    <div class="my-mei">
                        <div class="my-mei-top">
                            <p>我的国美，<i >请登录!</i></p>
                            <div>待处理订单<span> 我的收藏</span></div>
                            <div>我的金融<span> 个人资料</span></div>
                        </div>
                        <div class="my-mei-bottom">
                            <ul>
                                <li href="javascript:">红卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">蓝卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">店铺卷</li>
                                <li class="shuguang" href="javascript:"></li>
                                <li href="javascript:">购物卷</li>
                            </ul>
                        </div>
                    </div>
                </a></li>
                <li> <a href="javascript:">企业采购  </a></li>
                <li class="servir-servir"> <a href="javascript:">服务中心
                    <div class="servir">
                        <h3>售后服务</h3>
                        <div>物流与配送 <span>上门安装</span> <span>退换货服务</span></div>
                        <div>手机维修 &nbsp;&nbsp;&nbsp;<span>延保服务</span> <span>家电回收</span></div>
                        <h3>帮助问题</h3>
                        <div>焦点问题 <span>账户安全</span> <span>签收与验货</span></div>
                        <div>分期付款 <span>退款说明</span> <span>优惠券说明</span></div>
                        <p>在线客服</p>
                    </div>
                </a></li>
                <li class="qiye"> <a href="javascript:">企业导航
                    <div class="entreprise">
                        <dl>
                            <dt>主题促销</dt>
                            <dd>真划算 <span>家电城</span> <span>智能家居</span></dd>
                            <dd>抢购 <span>家装馆</span> <span>国美超市</span></dd>
                            <dd>海外购 <span>服饰城</span> <span>新品抢先</span></dd>
                            <dd>品牌街 <span>今日特卖</span></dd>
                            <dd></dd>
                        </dl>

                        <dl>
                            <dt> 特色分类</dt>
                            <dd>电视影音 <span>手机</span> <span>住宅家具</span> <span>服饰鞋帽</span> <span>食品酒水</span></dd>
                            <dd>冰洗 <span>数码</span> <span>家装建材</span> <span>运动户外</span> <span>医疗保健</span></dd>
                            <dd>洗衣机 <span>电脑办公</span> <span>家居日用</span> <span>箱包奢品</span> <span>母婴玩具</span></dd>
                            <dd>空调 <span>精品配件</span> <span>床品家纺</span> <span>表首饰</span> <span>美妆个护</span></dd>
                            <dd>厨卫生活 <span>汽车</span> <span>黄金收藏</span> <span>文化艺术</span> <span>家装频道</span></dd>
                        </dl>
                        <dl class="char">
                            <dt>便捷服务</dt>
                            <dd>话费充值 <span>流量充值</span></dd>
                            <dd>游戏点卡 <span>酒店</span></dd>
                            <dd>机票 <span>火车票</span></dd>
                            <dd>电影票 <span>演出票</span></dd>
                            <dd>美盈宝 <span>投金宝</span></dd>
                            <dd>定期理财 <span>票据理财</span></dd>
                            <dd>转让理财 <span> 转让理财</span></dd>
                        </dl>
                        <dl>
                            <dt>更多热点</dt>
                            <dd>商家入驻</dd>
                            <dd>企业采购</dd>
                        </dl>
                        <dl>
                            <dt>国美旗下</dt>
                            <dd>多边金都</dd>
                            <dd>国美家装</dd>
                            <dd>国美管家</dd>
                        </dl>
                    </div>
                </a></li>
                <li class="code"> <a href="javascript:">手机国美
                    <div class="portable-code">
                        <i></i>
                    </div>
                </a></li>
            </ul>
        </div>
    </div>
</div>

<!--搜索-->
<div class="helloworld">
    <div class="logo">
        <a href="../index.html"></a>
    </div>
    <div class="helloworld-center">
        <div class="center-center">
            <span>商品</span><i></i>
            <ul>
                <li>商品</li>
                <li>店铺</li>
                <li>话题</li>
                <li>圈子</li>
            </ul>
        </div>
        <div class="helloworld-from">
            <input type="text" id="search" placeholder="请输入想要输入的内容">
            <button id="helloworld" type="button">搜索</button>
        </div>
    </div>
    <div class="shopping">
        <span class="shopping-one">0</span>
        <a href="#"></a>
        <span class="shopping-two">购物车空了</span>
        <b></b>
        <div class="shopping-box">
            <p>购物车 <span>中还没有商品，赶紧选购</span></p>
        </div>
    </div>
</div>
<div class="classer">
    <div class="classer-center">
        <div class="classer-left">
            <h3>全部商品分类</h3>
        </div>
        <div class="classer-center-center">
            <ul id="guomeis"></ul>
        </div>
        <div class="classer-right">
            <marquee direction="down" scroll="scroll" scrollamount="5">
                <h3>生活家电 <span>最高省600</span></h3>
                <h3>空调减满 <span>最高省200</span></h3>
                <h3>家居家装节 <span>2件八折</span></h3>
            </marquee>
        </div>
    </div>
</div>
    <ul id="nihao"></ul>
<main class="wind">
    <div class="particulars">结算页面</div>
    <p class="append">收货地址:</p>
    <div class="address">
        <div>
            <ul class="address-ul">
            </ul>
            <input type="button" class="add-address" id="add-address" value="添加收货地址" />
        </div>
        <div class="show-all-address">显示全部地址</div>
        </div>
    <div class="order" id="order">下订单</div>
    </main>
<div class="modal register">
    <div class="container">
        <div class="hd">
            <span>添加收货地址</span>
            <div class="close">关闭</div>
        </div>
        <div class="bd">
            <form>
                <!--<label>-->
                    <!--地址详情: <input type="text" name="address_name" value="陕西西安">-->
                <!--</label>-->

                <label>
                    国家: <input type="text" name="country" value="中国">
                </label>
                <label>
                    省: <input type="text" name="province" value="陕西省">
                </label>
                <label>
                    市: <input type="text" name="city" value="西安市">
                </label>
                <label>
                    区: <input type="text" name="district" value="长安区">
                </label>
                <label>
                    收货人: <input type="text" name="consignee" value="xxx">
                </label>
                <label>
                    地址: <input type="text" name="address" value="xxx">
                </label>
                <label>
                    邮编: <input type="text" name="zip_code" value="000000">
                </label>
                <label>
                    手机号: <input type="tel" name="mobile" value="1999203xxxx">
                </label>
                <label>
                    邮箱: <input type="email" name="email" value="xxxxxxx@sina.com">
                </label>
                <label>
                    电话: <input type="tel" name="tel" value="0000000">
                </label>

                <label>
                    <input type="button" value="添加" class="add">
                </label>
            </form>
        </div>
    </div>
</div>
<!--品质、低价、速达-->
<div class="footer">
    <div class="footer-top">
        <li><a href="" class="outer">
            <p>品质</p></a>
            <span></span>
            <a href="" class="inside">正品行货 购物无忧</a></li>
        <li><a href="" class="outer outer2">
            <p>低价</p></a>
            <span></span>
            <a href="" class="inside">普惠实价 帮你省钱</a></li>
        <li><a href="" class="outer outer3">
            <p>速达</p></a>
            <span></span>
            <a href="" class="inside">专业配送 按时按需</a></li>
    </div>
    <!--服务列表-->
    <div class="footer-centre">
        <li class="footer-centre0">
            <p class="footer-centre1">物流配送</p>
            <p><a href="javascript:">配送查询</a></p>
            <p><a href="javascript:">配送服务</a></p>
            <p><a href="javascript:">配送费用</a></p>
            <p><a href="javascript:">配送时效</a></p>
            <p><a href="javascript:">签收与验货</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">支付与账户</p>
            <p><a href="javascript:">货到付款</a></p>
            <p><a href="javascript:">在线支付</a></p>
            <p><a href="javascript:">分期付款</a></p>
            <p><a href="javascript:">门店支付</a></p>
            <p><a href="javascript:">账户安全</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">售后服务</p>
            <p><a href="javascript:">退换货服务</a></p>
            <p><a href="javascript:">退款说明</a></p>
            <p><a href="javascript:">专业维修</a></p>
            <p><a href="javascript:">延保服务</a></p>
            <p><a href="javascript:">家电回收</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">会员专区</p>
            <p><a href="javascript:">会员介绍</a></p>
            <p><a href="javascript:">优惠券说明</a></p>
            <p><a href="javascript:">美豆说明</a></p>
            <p><a href="javascript:">商品评价</a></p>
        </li>
        <li class="footer-centre0 footer-centre-0">
            <p class="footer-centre1">购物帮助</p>
            <p><a href="javascript:">购物保障</a></p>
            <p><a href="javascript:">购物流程</a></p>
            <p><a href="javascript:">促销优惠</a></p>
            <p><a href="javascript:">焦点问题</a></p>
            <p><a href="javascript:">联系我们</a></p>
        </li>
    </div>
    <!--商城介绍-->
    <div class="footer-bottom">
        <div class="footer-bottom0">
            <div class="box">
                <span>
                    <i></i>
                    <p>
                        <strong>门店服务</strong>
                        <a href="javascript:">国美门店全国共2000余家</a>
                    </p>
                </span>
                <span>
                    <i class="box-fix"></i>
                    <p>
                        <strong>用户体验</strong>
                        <a href="javascript:">参与用户体验改进计划 用户反馈</a>
                    </p>
                </span>
                <div class="code">
                    <i></i>
                    <p>公众号</p>
                    <div class="code-img">
                        <img src="../img/T1GObvBQZs1RCvBVdK.jpg">
                    </div>
                </div>
                <div class="code code-wap">
                    <i class="code-wap1"></i>
                    <p>手机站点</p>
                    <div class="code-img">
                        <img src="../img/T1m2YvBTDj1RCvBVdK.jpg">
                    </div>
                </div>
                <div class="code-app">
                    <i><img src="../img/T1g2LvBbdj1RCvBVdK.png" alt=""></i>
                    <p>扫描下载客户端</p>

                </div>
                <ul class="headline">
                    <a href="javascript:"><li>国美集团</li></a>
                    <a href="javascript:"><li>国美管家</li></a>
                    <a href="javascript:"><li>关于国美</li></a>
                    <a href="javascript:"><li>加入我们 &nbsp;&nbsp;|</li></a>
                    <a href="javascript:"> <li>品牌大全</li></a>
                    <a href="javascript:"> <li>商品专题</li></a>
                    <a href="javascript:"><li>批发大全</li></a>
                    <a href="javascript:"><li>热词搜索</li></a>
                    <a href="javascript:"><li>友情链接</li></a>
                    <a href="javascript:"><li>风险监测 &nbsp;&nbsp;|</li></a>
                    <a href="javascript:"><li>销售联盟</li></a>
                    <a href="javascript:"> <li>商家入驻</li></a>
                </ul>
                <p class="version">国美在线电子商务有限公司  办公地址:上海市嘉定区沪宜公路3163-3199号一楼A区  客服电话:4008708708  |  本公司游戏产品适合18岁以上成年人使用</p>
                <p class="version">2000-2017  国美在线电子商务有限公司版权所有  京公安网备11010502027062  沪ICP备11009419号  沪B2-20120004号</p>
                <div class="credit">
                    <ul class="credits">
                        <li><div class="img xinxi"></div><p>经营性网站备案信息</p></li>
                        <li><div class="img pinjia"></div><p>可信网站信用评价</p></li>
                        <li><div class="img wangzhan"></div><p>诚信网站</p></li>
                        <li><div class="img jingcha"></div><p>朝阳网络警察</p></li>
                        <li><div class="img dajiaping"></div><p>网购大家评</p></li>
                        <li class="change"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../js/myajax.js"></script>
<script>
    if(localStorage.username){
        var oUsername=document.querySelector("a[name=username]");
        var oLogout=document.querySelector(".logout");
        oUsername.innerText=localStorage.username;
        oUsername.style.display="inline";
        oLogout.style.display="inline";
    }else {
        var oRegister = document.querySelector('.register');
        var oLogin = document.querySelector('.login');
        oRegister.style.display = 'inline';
        oLogin.style.display = 'inline';
    }
</script>
<script>
    var oSearch = document.querySelector("#search");
    var ohelloworld=document.querySelector("#helloworld");

    ohelloworld.onclick=function(){
        myajax.get("http://h6.duchengjiu.top/shop/api_goods.php",{
            search_text:oSearch.value,
            page:1,
            pagesize:20
        },function(error,responseText){
            var json=JSON.parse(responseText);
            console.log(json)
            location.href = '../html/rechercher.html?'+oSearch.value;

        })
    }

</script>
<script>
    var oUl=document.querySelector("#guomeis");
    myajax.get("http://h6.duchengjiu.top/shop/api_cat.php",{},function(error,responseText){
        var json=JSON.parse(responseText);
        console.log(json);
        var data=json.data;
        for(var i=0;i<data.length;i++){
            var obj=data[i];
            oUl.innerHTML+=`
            <li class="left"><a href="../index.html?cat_id=${obj.cat_id}">
            ${obj.cat_name}
            </a>
            </li>`
        }
    })
    //----------------------------------
    function getQueryString(name){
        var search=location.search.substr(1);
        var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
        var result=search.match(reg);
//        if(result===null) return null;
//        return decodeURIComponent(result[2]);
        //三目用算
        return result===null?null:decodeURIComponent(result[2])
    }

</script>
<script src="../js/animate.js"></script>
<script>
    var oShowAllAddress = document.querySelector('.show-all-address');
    oShowAllAddress.addEventListener('click', function(){
        var oAddressUl = document.querySelector('.address-ul');
        var overflow = fetchComputedStyle(oAddressUl, 'overflow');
        var flag = overflow === 'hidden' ? false : true;
        oAddressUl.style.overflow = !flag ? 'visible' : 'hidden';
        this.innerText = flag ? '显示全部地址' : '隐藏地址';
    });
</script>
<script>
    //ajax读取到收货地址并显示
    function showAddress() {
        myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',
                {token: localStorage.token},
                function(error, responseText) {
                    var json = JSON.parse(responseText);
                    console.log(json);
                    var data = json.data;
                    var oAddressUl = document.querySelector('.address-ul');
                    if (data.length === 0) {
                        oAddressUl.innerHTML = '<h2>您还没有收货地址，请点击添加收货地址</h2>';
                        return;
                    }
                    oAddressUl.innerHTML = '';
                    for (var i = data.length - 1; i >= 0; i--) {
                        var obj = data[i];
                        oAddressUl.innerHTML += `
                            <li data-id="${obj.address_id}">
                              <span>收货人：${obj.consignee}</span><span name="delete" class="delete" data-id="${obj.address_id}">删除</span><br />
                              <span>手机：${obj.mobile}</span><br />
                              <span>地址：${obj.address}</span>
                            </li>
            `;
                    }
                })
    }
    showAddress();

    var selected_address_id = 0;//如果这个值为0，无法下订单，当点击一个收货地址时，给这个变量赋值
    //给收货地址添加一个事件代理
    var oAddressUl = document.querySelector('.address-ul');
    oAddressUl.onclick = function(event) {
        event = event || window.event;
        var target = event.target || event.srcElement;
        console.log(target.nodeName);
        if (target.className === 'delete') {
            if (!confirm('确认要删除收货地址吗？')) {
                return;
            }
            var address_id = target.dataset.id;
            console.log(address_id);
            myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',
                    {status: 'delete', address_id, token: localStorage.token}, function(error, responseText){
                        var json = JSON.parse(responseText);
                        if (json.code === 0) {
                            target.parentNode.parentNode.removeChild(target.parentNode);
                        }
                    })
        } else {
            //先让所有li元素的样式清空
            var oAddressLis = oAddressUl.querySelectorAll('li');
            for (var i = 0; i < oAddressLis.length; i++) {
                oAddressLis[i].classList.remove('selected');
            }

            if (target.nodeName === 'LI') {
                //点击LI元素选择一个收货地址
                selected_address_id = parseInt(target.dataset.id);
                target.classList.add('selected');
            } else if (target.nodeName === 'SPAN'){
                selected_address_id = parseInt(target.parentNode.dataset.id);
                target.parentNode.classList.add('selected');
            }

        }
    }
</script>
<script>
    var oOrder = document.querySelector('#order');
    oOrder.onclick = function() {
        var address_id = selected_address_id;
        if (address_id === 0) {
            alert('请选择一个收货地址');
            return;
        }
        var total_prices = localStorage.sum;
        myajax.post('http://h6.duchengjiu.top/shop/api_order.php?token='+localStorage.token+'&status=add', {address_id, total_prices}, function(err, responseText){
            var json = JSON.parse(responseText);
            console.log(json);
            if (json.code === 0) {
                alert('下订单成功');
                location.href = '07.html';
            }
        });

    }
</script>
<script src="../js/modal.js"></script>
<script>
    var modal = new Modal('#add-address');

    //给添加按钮添加事件
    var oAdd = document.querySelector('.add');
    oAdd.onclick = function() {
        var postobj = serializeForm(document.querySelector('form'));
        myajax.post('http://h6.duchengjiu.top/shop/api_useraddress.php?status=add&token='+localStorage.token, postobj, function(err, responseText){
            var json = JSON.parse(responseText);
            console.log(json);
            if (json.code === 0) {
                modal.hide();
                showAddress();
            }
        });
    }
</script>
</html>